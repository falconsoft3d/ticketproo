{% extends 'base.html' %}{% extends 'base.html' %}

{% load static %}{% load static %}



{% block title %}{{ page_title }}{% endblock %}{% block title %}{{ page_title }}{% endblock %}



{% block content %}{% block content %}

<div class="row"><div class="row">

    <div class="col-12">    <div class="col-12">

        <div class="d-flex justify-content-between align-items-center mb-4">        <div class="d-flex justify-content-between align-items-center mb-4">

            <div>            <div>

                <nav aria-label="breadcrumb">                <nav aria-label="breadcrumb">

                    <ol class="breadcrumb">                    <ol class="breadcrumb">

                        <li class="breadcrumb-item">                        <li class="breadcrumb-item">

                            <a href="{% url 'course_public' course.public_token %}">{{ course.title }}</a>                            <a href="{% url 'course_public' course.public_token %}">{{ course.title }}</a>

                        </li>                        </li>

                        <li class="breadcrumb-item active">{{ course_class.title }}</li>                        <li class="breadcrumb-item active">{{ course_class.title }}</li>

                    </ol>                    </ol>

                </nav>                </nav>

                                

                <div class="alert alert-info mb-3">                <div class="alert alert-info mb-3">

                    <i class="bi bi-info-circle"></i> <strong>Vista Pública</strong> - Esta clase está disponible sin necesidad de autenticación                    <i class="bi bi-info-circle"></i> <strong>Vista Pública</strong> - Esta clase está disponible sin necesidad de autenticación

                </div>                </div>

                                

                <h1 class="h3 mb-0 text-primary">                <h1 class="h3 mb-0 text-primary">

                    <i class="bi bi-play-circle"></i> {{ course_class.title }}                    <i class="bi bi-play-circle"></i> {{ course_class.title }}

                </h1>                </h1>

                <p class="text-muted mb-0">Curso: {{ course.title }}</p>                <p class="text-muted mb-0">Curso: {{ course.title }}</p>

                <p class="text-muted mb-0">Instructor: {{ course.created_by.get_full_name|default:course.created_by.username }}</p>                <p class="text-muted mb-0">Instructor: {{ course.created_by.get_full_name|default:course.created_by.username }}</p>

            </div>            </div>

                        

            {% if not user.is_authenticated %}            {% if not user.is_authenticated %}

                <div class="btn-group">                <div class="btn-group">

                    <a href="{% url 'login' %}" class="btn btn-outline-primary">                    <a href="{% url 'login' %}" class="btn btn-outline-primary">

                        <i class="bi bi-box-arrow-in-right"></i> Iniciar Sesión                        <i class="bi bi-box-arrow-in-right"></i> Iniciar Sesión

                    </a>                    </a>

                    <a href="{% url 'register' %}" class="btn btn-primary">                    <a href="{% url 'register' %}" class="btn btn-primary">

                        <i class="bi bi-person-plus"></i> Registrarse                        <i class="bi bi-person-plus"></i> Registrarse

                    </a>                    </a>

                </div>                </div>

            {% endif %}            {% endif %}

        </div>        </div>

    </div>    </div>

</div></div>



<div class="row"><div class="row">

    <div class="col-lg-8">    <div class="col-lg-8">

        <!-- Contenido de la Clase -->        <!-- Contenido de la Clase -->

        <div class="card mb-4">        <div class="card mb-4">

            <div class="card-header bg-primary text-white">            <div class="card-header bg-primary text-white">

                <h5 class="mb-0">                <h5 class="mb-0">

                    <i class="bi bi-play-circle"></i> Contenido de la Clase                    <i class="bi bi-play-circle"></i> Contenido de la Clase

                </h5>                </h5>

            </div>            </div>

            <div class="card-body">            <div class="card-body">

                {% if course_class.description %}                {% if course_class.description %}

                    <div class="mb-4">                    <div class="mb-4">

                        <h6 class="text-muted mb-2">Descripción:</h6>                        <h6 class="text-muted mb-2">Descripción:</h6>

                        <p>{{ course_class.description|linebreaks }}</p>                        <p>{{ course_class.description|linebreaks }}</p>

                    </div>                    </div>

                {% endif %}                {% endif %}

                                

                {% if course_class.video_url %}                {% if course_class.video_url %}

                    <div class="mb-4">                    <div class="mb-4">

                        <h6 class="text-muted mb-2">Video de la Clase:</h6>                        <h6 class="text-muted mb-2">Video de la Clase:</h6>

                        <div class="alert alert-success">                        <div class="alert alert-success">

                            <div class="d-flex justify-content-between align-items-center">                            <div class="d-flex justify-content-between align-items-center">

                                <div>                                <div>

                                    <strong><i class="bi bi-play-circle"></i> Video disponible</strong><br>                                    <strong><i class="bi bi-play-circle"></i> Video disponible</strong><br>

                                    <small class="text-muted">Haz clic en el botón para abrir el video en una nueva pestaña</small>                                    <small class="text-muted">Haz clic en el botón para abrir el video en una nueva pestaña</small>

                                </div>                                </div>

                                <button class="btn btn-success" onclick="window.open('{{ course_class.video_url }}', '_blank')">                                <button class="btn btn-success" onclick="window.open('{{ course_class.video_url }}', '_blank')">

                                    <i class="bi bi-play-circle"></i> Ver Video                                    <i class="bi bi-play-circle"></i> Ver Video

                                </button>                                </button>

                            </div>                            </div>

                        </div>                        </div>

                                                

                        <div class="mt-3">                        <div class="mt-3">

                            <small class="text-muted">URL del video:</small><br>                            <small class="text-muted">URL del video:</small><br>

                            <a href="{{ course_class.video_url }}" target="_blank" class="text-decoration-none">                            <a href="{{ course_class.video_url }}" target="_blank" class="text-decoration-none">

                                {{ course_class.video_url }}                                {{ course_class.video_url }}

                                <i class="bi bi-box-arrow-up-right ms-1"></i>                                <i class="bi bi-box-arrow-up-right ms-1"></i>

                            </a>                            </a>

                        </div>                        </div>

                    </div>                    </div>

                {% endif %}                {% endif %}

                                

                {% if course_class.content %}                {% if course_class.content %}

                    <div class="mb-4">                    <div class="mb-4">

                        <h6 class="text-muted mb-2">Contenido Adicional:</h6>                        <h6 class="text-muted mb-2">Contenido Adicional:</h6>

                        <div class="border rounded p-3 bg-light">                        <div class="border rounded p-3 bg-light">

                            {{ course_class.content|linebreaks }}                            {{ course_class.content|linebreaks }}

                        </div>                        </div>

                    </div>                    </div>

                {% endif %}                {% endif %}

            </div>            </div>

        </div>        </div>

                

        <!-- Navegación entre clases -->        <!-- Navegación entre clases -->

        <div class="card">        <div class="card">

            <div class="card-header bg-secondary text-white">            <div class="card-header bg-secondary text-white">

                <h6 class="mb-0">                <h6 class="mb-0">

                    <i class="bi bi-arrow-left-right"></i> Navegación                    <i class="bi bi-arrow-left-right"></i> Navegación

                </h6>                </h6>

            </div>            </div>

            <div class="card-body">            <div class="card-body">

                <div class="row">                <div class="row">

                    <div class="col-6">                    <div class="col-6">

                        {% if previous_class %}                        {% if previous_class %}

                            <a href="{% url 'course_class_public' course.public_token previous_class.pk %}"                             <a href="{% url 'course_class_public' course.public_token previous_class.pk %}" 

                               class="btn btn-outline-secondary w-100">                               class="btn btn-outline-secondary w-100">

                                <i class="bi bi-arrow-left"></i> Anterior<br>                                <i class="bi bi-arrow-left"></i> Anterior<br>

                                <small>{{ previous_class.title|truncatechars:30 }}</small>                                <small>{{ previous_class.title|truncatechars:30 }}</small>

                            </a>                            </a>

                        {% else %}                        {% else %}

                            <div class="btn btn-outline-secondary w-100 disabled">                            <div class="btn btn-outline-secondary w-100 disabled">

                                <i class="bi bi-arrow-left"></i> No hay clase anterior                                <i class="bi bi-arrow-left"></i> No hay clase anterior

                            </div>                            </div>

                        {% endif %}                        {% endif %}

                    </div>                    </div>

                    <div class="col-6">                    <div class="col-6">

                        {% if next_class %}                        {% if next_class %}

                            <a href="{% url 'course_class_public' course.public_token next_class.pk %}"                             <a href="{% url 'course_class_public' course.public_token next_class.pk %}" 

                               class="btn btn-outline-primary w-100">                               class="btn btn-outline-primary w-100">

                                <i class="bi bi-arrow-right"></i> Siguiente<br>                                <i class="bi bi-arrow-right"></i> Siguiente<br>

                                <small>{{ next_class.title|truncatechars:30 }}</small>                                <small>{{ next_class.title|truncatechars:30 }}</small>

                            </a>                            </a>

                        {% else %}                        {% else %}

                            <div class="btn btn-outline-primary w-100 disabled">                            <div class="btn btn-outline-primary w-100 disabled">

                                <i class="bi bi-arrow-right"></i> No hay clase siguiente                                <i class="bi bi-arrow-right"></i> No hay clase siguiente

                            </div>                            </div>

                        {% endif %}                        {% endif %}

                    </div>                    </div>

                </div>                </div>

            </div>            </div>

        </div>        </div>

    </div>    </div>

        

    <div class="col-lg-4">    <div class="col-lg-4">

        <!-- Información de la Clase -->        <!-- Información de la Clase -->

        <div class="card mb-4">        <div class="card mb-4">

            <div class="card-header bg-info text-white">            <div class="card-header bg-info text-white">

                <h6 class="mb-0">                <h6 class="mb-0">

                    <i class="bi bi-info-circle"></i> Información de la Clase                    <i class="bi bi-info-circle"></i> Información de la Clase

                </h6>                </h6>

            </div>            </div>

            <div class="card-body">            <div class="card-body">

                <div class="d-flex justify-content-between align-items-center mb-2">                <div class="d-flex justify-content-between align-items-center mb-2">

                    <small class="text-muted">Curso:</small>                    <small class="text-muted">Curso:</small>

                    <span class="badge bg-primary">{{ course.title }}</span>                    <span class="badge bg-primary">{{ course.title }}</span>

                </div>                </div>

                                

                {% if course_class.order %}                {% if course_class.order %}

                <div class="d-flex justify-content-between align-items-center mb-2">                <div class="d-flex justify-content-between align-items-center mb-2">

                    <small class="text-muted">Orden:</small>                    <small class="text-muted">Orden:</small>

                    <span>{{ course_class.order }}</span>                    <span>{{ course_class.order }}</span>

                </div>                </div>

                {% endif %}                {% endif %}

                                

                <div class="d-flex justify-content-between align-items-center mb-2">                <div class="d-flex justify-content-between align-items-center mb-2">

                    <small class="text-muted">Creado:</small>                    <small class="text-muted">Creado:</small>

                    <span>{{ course_class.created_at|date:"d/m/Y" }}</span>                    <span>{{ course_class.created_at|date:"d/m/Y" }}</span>

                </div>                </div>

                                

                <div class="d-flex justify-content-between align-items-center mb-2">                <div class="d-flex justify-content-between align-items-center mb-2">

                    <small class="text-muted">Vistas:</small>                    <small class="text-muted">Vistas:</small>

                    <span class="badge bg-success">{{ course_class.get_view_count }}</span>                    <span class="badge bg-success">{{ course_class.get_view_count }}</span>

                </div>                </div>

                                

                {% if user.is_authenticated %}                {% if user.is_authenticated %}

                    <div class="d-flex justify-content-between align-items-center mb-2">                    <div class="d-flex justify-content-between align-items-center mb-2">

                        <small class="text-muted">Tu estado:</small>                        <small class="text-muted">Tu estado:</small>

                        {% if user_has_viewed %}                        {% if user_has_viewed %}

                            <span class="badge bg-success">                            <span class="badge bg-success">

                                <i class="bi bi-check-circle"></i> Vista                                <i class="bi bi-check-circle"></i> Vista

                            </span>                            </span>

                        {% else %}                        {% else %}

                            <span class="badge bg-secondary">                            <span class="badge bg-secondary">

                                <i class="bi bi-circle"></i> Sin ver                                <i class="bi bi-circle"></i> Sin ver

                            </span>                            </span>

                        {% endif %}                        {% endif %}

                    </div>                    </div>

                {% endif %}                {% endif %}

                                

                <hr>                <hr>

                                

                <div class="alert alert-warning p-2">                <div class="alert alert-warning p-2">

                    <div class="d-flex justify-content-between align-items-center">                    <div class="d-flex justify-content-between align-items-center">

                        <small class="text-warning fw-bold">                        <small class="text-warning fw-bold">

                            <i class="bi bi-share"></i> Vista Pública                            <i class="bi bi-share"></i> Vista Pública

                        </small>                        </small>

                        <span class="badge bg-warning text-dark">Activa</span>                        <span class="badge bg-warning text-dark">Activa</span>

                    </div>                    </div>

                    <p class="small mb-0 mt-1">Esta clase es accesible públicamente.</p>                    <p class="small mb-0 mt-1">Esta clase es accesible públicamente.</p>

                </div>                </div>

            </div>            </div>

        </div>        </div>

                

        <!-- Acciones -->        <!-- Acciones -->

        <div class="card">        <div class="card">

            <div class="card-header bg-warning text-dark">            <div class="card-header bg-warning text-dark">

                <h6 class="mb-0">                <h6 class="mb-0">

                    <i class="bi bi-tools"></i> Acciones                    <i class="bi bi-tools"></i> Acciones

                </h6>                </h6>

            </div>            </div>

            <div class="card-body">            <div class="card-body">

                <div class="d-grid gap-2">                <div class="d-grid gap-2">

                    <a href="{% url 'course_public' course.public_token %}" class="btn btn-outline-secondary">                    <a href="{% url 'course_public' course.public_token %}" class="btn btn-outline-secondary">

                        <i class="bi bi-arrow-left"></i> Volver al Curso                        <i class="bi bi-arrow-left"></i> Volver al Curso

                    </a>                    </a>

                                        

                    {% if course_class.video_url %}                    {% if course_class.video_url %}

                        <button class="btn btn-success" onclick="window.open('{{ course_class.video_url }}', '_blank')">                        <button class="btn btn-success" onclick="window.open('{{ course_class.video_url }}', '_blank')">

                            <i class="bi bi-play-circle"></i> Ver Video                            <i class="bi bi-play-circle"></i> Ver Video

                        </button>                        </button>

                    {% endif %}                    {% endif %}

                                        

                    {% if user.is_authenticated %}                    {% if user.is_authenticated %}

                        <a href="{% url 'course_class_detail' course.pk course_class.pk %}" class="btn btn-primary">                        <a href="{% url 'course_class_detail' course.pk course_class.pk %}" class="btn btn-primary">

                            <i class="bi bi-lock"></i> Ver Versión Privada                            <i class="bi bi-lock"></i> Ver Versión Privada

                        </a>                        </a>

                                                

                        {% if not user_has_viewed %}                        {% if not user_has_viewed %}

                            <button class="btn btn-outline-success"                             <button class="btn btn-outline-success" 

                                    onclick="markAsViewed('{{ course_class.pk }}', '{{ course.pk }}')">                                    onclick="markAsViewed('{{ course_class.pk }}', '{{ course.pk }}')">

                                <i class="bi bi-check-circle"></i> Marcar como Vista                                <i class="bi bi-check-circle"></i> Marcar como Vista

                            </button>                            </button>

                        {% endif %}                        {% endif %}

                    {% else %}                    {% else %}

                        <a href="{% url 'register' %}" class="btn btn-primary">                        <a href="{% url 'register' %}" class="btn btn-primary">

                            <i class="bi bi-person-plus"></i> Registrarse                            <i class="bi bi-person-plus"></i> Registrarse

                        </a>                        </a>

                        <a href="{% url 'login' %}" class="btn btn-outline-primary">                        <a href="{% url 'login' %}" class="btn btn-outline-primary">

                            <i class="bi bi-box-arrow-in-right"></i> Iniciar Sesión                            <i class="bi bi-box-arrow-in-right"></i> Iniciar Sesión

                        </a>                        </a>

                    {% endif %}                    {% endif %}

                </div>                </div>

            </div>            </div>

        </div>        </div>

    </div>    </div>

</div></div>



<script><script>

function markAsViewed(classId, courseId) {function markAsViewed(classId, courseId) {

    // Verificar si el usuario está autenticado    // Verificar si el usuario está autenticado

    {% if not user.is_authenticated %}    {% if not user.is_authenticated %}

        alert('Debes iniciar sesión para marcar las clases como vistas.');        alert('Debes iniciar sesión para marcar las clases como vistas.');

        return;        return;

    {% endif %}    {% endif %}

        

    // Marcar como vista via AJAX    // Marcar como vista via AJAX

    fetch(`/courses/${courseId}/classes/${classId}/mark-viewed/`, {    fetch(`/courses/${courseId}/classes/${classId}/mark-viewed/`, {

        method: 'POST',        method: 'POST',

        headers: {        headers: {

            'X-CSRFToken': getCookie('csrftoken'),            'X-CSRFToken': getCookie('csrftoken'),

            'Content-Type': 'application/json',            'Content-Type': 'application/json',

        },        },

    })    })

    .then(response => response.json())    .then(response => response.json())

    .then(data => {    .then(data => {

        if (data.success) {        if (data.success) {

            // Recargar la página para actualizar el estado            // Recargar la página para actualizar el estado

            location.reload();            location.reload();

        } else {        } else {

            alert('Error al marcar la clase como vista: ' + data.error);            alert('Error al marcar la clase como vista: ' + data.error);

        }        }

    })    })

    .catch(error => {    .catch(error => {

        console.error('Error:', error);        console.error('Error:', error);

        alert('Error de conexión');        alert('Error de conexión');

    });    });

}}



function getCookie(name) {function getCookie(name) {

    let cookieValue = null;    let cookieValue = null;

    if (document.cookie && document.cookie !== '') {    if (document.cookie && document.cookie !== '') {

        const cookies = document.cookie.split(';');        const cookies = document.cookie.split(';');

        for (let i = 0; i < cookies.length; i++) {        for (let i = 0; i < cookies.length; i++) {

            const cookie = cookies[i].trim();            const cookie = cookies[i].trim();

            if (cookie.substring(0, name.length + 1) === (name + '=')) {            if (cookie.substring(0, name.length + 1) === (name + '=')) {

                cookieValue = decodeURIComponent(cookie.substring(name.length + 1));                cookieValue = decodeURIComponent(cookie.substring(name.length + 1));

                break;                break;

            }            }

        }        }

    }    }

    return cookieValue;    return cookieValue;

}}

</script></script>

{% endblock %}{% endblock %}