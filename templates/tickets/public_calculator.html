<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calculadora Científica - TicketProo</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    <style>
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .main-container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .calculator-container {
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
            height: 100%;
        }
        
        .history-container {
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
            height: 100%;
            max-height: 800px;
            display: flex;
            flex-direction: column;
        }
        
        .calc-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 15px 15px 0 0;
        }
        
        .calc-display {
            background: #f8f9fa;
            padding: 15px;
            border-bottom: 2px solid #e9ecef;
        }
        
        .calc-btn {
            padding: 15px;
            font-size: 1.1rem;
            border-radius: 8px;
            transition: all 0.2s;
        }
        
        .calc-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }
        
        .calc-btn:active {
            transform: translateY(0);
        }
        
        #calculatorExpression {
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            background: white;
            color: #666;
            border: none;
        }
        
        #calculatorDisplay {
            font-family: 'Courier New', monospace;
            font-size: 2rem;
            background: #f8f9fa;
            font-weight: bold;
            border: none;
        }
        
        .footer-brand {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 0 0 15px 15px;
            text-align: center;
            border-top: 2px solid #e9ecef;
        }
        
        .history-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 15px 15px 0 0;
        }
        
        .history-list {
            flex: 1;
            overflow-y: auto;
            padding: 15px;
        }
        
        .history-item {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 10px;
            border-left: 4px solid #667eea;
            transition: all 0.2s;
        }
        
        .history-item:hover {
            background: #e9ecef;
            transform: translateX(5px);
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            cursor: pointer;
        }
        
        .history-expression {
            color: #666;
            font-size: 0.9rem;
            font-family: 'Courier New', monospace;
        }
        
        .history-result {
            color: #667eea;
            font-size: 1.2rem;
            font-weight: bold;
            font-family: 'Courier New', monospace;
        }
        
        .history-empty {
            text-align: center;
            padding: 40px 20px;
            color: #999;
        }
        
        .clear-history-btn {
            margin: 15px;
        }
    </style>
</head>
<body>
    <div class="main-container">
        <div class="row g-3">
            <!-- Columna Calculadora -->
            <div class="col-lg-6">
                <div class="calculator-container">
        <!-- Header -->
        <div class="calc-header">
            <h4 class="mb-1"><i class="bi bi-calculator me-2"></i>Calculadora Científica</h4>
            <small class="opacity-75">Herramienta gratuita de TicketProo</small>
        </div>

        <!-- Display -->
        <div class="calc-display">
            <div class="mb-1">
                <input type="text" id="calculatorExpression" class="form-control form-control-sm text-end" 
                       value="" readonly>
            </div>
            <div>
                <input type="text" id="calculatorDisplay" class="form-control form-control-lg text-end" 
                       value="0" readonly>
            </div>
        </div>

        <!-- Mode Tabs -->
        <div class="p-3 pb-0">
            <div class="btn-group btn-group-sm w-100" role="group">
                <button type="button" class="btn btn-outline-primary active" id="btnBasic" onclick="switchCalcMode('basic')">Básica</button>
                <button type="button" class="btn btn-outline-primary" id="btnScientific" onclick="switchCalcMode('scientific')">Científica</button>
            </div>
        </div>

        <!-- Basic Buttons -->
        <div id="basicButtons" class="p-3" style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 8px;">
            <button class="btn btn-outline-secondary calc-btn" onclick="clearCalculator()" style="grid-column: span 2;"><strong>AC</strong></button>
            <button class="btn btn-outline-secondary calc-btn" onclick="deleteLast()"><i class="bi bi-backspace"></i></button>
            <button class="btn btn-outline-warning calc-btn" onclick="appendToExpression('/')">÷</button>

            <button class="btn btn-outline-dark calc-btn" onclick="appendToExpression('7')">7</button>
            <button class="btn btn-outline-dark calc-btn" onclick="appendToExpression('8')">8</button>
            <button class="btn btn-outline-dark calc-btn" onclick="appendToExpression('9')">9</button>
            <button class="btn btn-outline-warning calc-btn" onclick="appendToExpression('*')">×</button>

            <button class="btn btn-outline-dark calc-btn" onclick="appendToExpression('4')">4</button>
            <button class="btn btn-outline-dark calc-btn" onclick="appendToExpression('5')">5</button>
            <button class="btn btn-outline-dark calc-btn" onclick="appendToExpression('6')">6</button>
            <button class="btn btn-outline-warning calc-btn" onclick="appendToExpression('-')">−</button>

            <button class="btn btn-outline-dark calc-btn" onclick="appendToExpression('1')">1</button>
            <button class="btn btn-outline-dark calc-btn" onclick="appendToExpression('2')">2</button>
            <button class="btn btn-outline-dark calc-btn" onclick="appendToExpression('3')">3</button>
            <button class="btn btn-outline-warning calc-btn" onclick="appendToExpression('+')">+</button>

            <button class="btn btn-outline-info calc-btn" onclick="appendToExpression('(')">(</button>
            <button class="btn btn-outline-dark calc-btn" onclick="appendToExpression('0')">0</button>
            <button class="btn btn-outline-info calc-btn" onclick="appendToExpression(')')">)</button>
            <button class="btn btn-outline-dark calc-btn" onclick="appendToExpression('.')">.</button>

            <button class="btn btn-primary calc-btn" onclick="calculate()" style="grid-column: span 4;"><strong>=</strong></button>
        </div>

        <!-- Scientific Buttons -->
        <div id="scientificButtons" class="p-3" style="display: none; grid-template-columns: repeat(4, 1fr); gap: 8px;">
            <button class="btn btn-outline-success calc-btn" onclick="appendFunction('Math.sin')">sin</button>
            <button class="btn btn-outline-success calc-btn" onclick="appendFunction('Math.cos')">cos</button>
            <button class="btn btn-outline-success calc-btn" onclick="appendFunction('Math.tan')">tan</button>
            <button class="btn btn-outline-info calc-btn" onclick="appendToExpression('Math.PI')">π</button>

            <button class="btn btn-outline-success calc-btn" onclick="appendFunction('Math.asin')">asin</button>
            <button class="btn btn-outline-success calc-btn" onclick="appendFunction('Math.acos')">acos</button>
            <button class="btn btn-outline-success calc-btn" onclick="appendFunction('Math.atan')">atan</button>
            <button class="btn btn-outline-info calc-btn" onclick="appendToExpression('Math.E')">e</button>

            <button class="btn btn-outline-warning calc-btn" onclick="appendFunction('Math.pow')">x<sup>y</sup></button>
            <button class="btn btn-outline-warning calc-btn" onclick="appendFunction('Math.sqrt')">√</button>
            <button class="btn btn-outline-warning calc-btn" onclick="appendToExpression('**2')">x²</button>
            <button class="btn btn-outline-warning calc-btn" onclick="appendToExpression('**3')">x³</button>

            <button class="btn btn-outline-info calc-btn" onclick="appendFunction('Math.log10')">log</button>
            <button class="btn btn-outline-info calc-btn" onclick="appendFunction('Math.log')">ln</button>
            <button class="btn btn-outline-info calc-btn" onclick="appendFunction('Math.exp')">e<sup>x</sup></button>
            <button class="btn btn-outline-secondary calc-btn" onclick="appendToExpression('!')">n!</button>

            <button class="btn btn-outline-secondary calc-btn" onclick="appendFunction('Math.abs')">|x|</button>
            <button class="btn btn-outline-secondary calc-btn" onclick="appendFunction('Math.floor')">⌊x⌋</button>
            <button class="btn btn-outline-secondary calc-btn" onclick="appendFunction('Math.ceil')">⌈x⌉</button>
            <button class="btn btn-outline-secondary calc-btn" onclick="appendFunction('Math.round')">round</button>
        </div>

        <!-- Footer -->
        <div class="footer-brand">
            <small class="text-muted">
                Powered by <strong>TicketProo</strong> | 
                <a href="/" class="text-decoration-none">Ir al sistema</a>
            </small>
        </div>
                </div>
            </div>

            <!-- Columna Historial -->
            <div class="col-lg-6">
                <div class="history-container">
                    <!-- Header del historial -->
                    <div class="history-header">
                        <h4 class="mb-1"><i class="bi bi-clock-history me-2"></i>Historial de Cálculos</h4>
                        <small class="opacity-75">Tus últimas operaciones</small>
                    </div>

                    <!-- Lista de historial -->
                    <div class="history-list" id="historyList">
                        <div class="history-empty">
                            <i class="bi bi-calculator" style="font-size: 3rem;"></i>
                            <p class="mt-3">No hay cálculos aún</p>
                            <small>Comienza a calcular para ver tu historial</small>
                        </div>
                    </div>

                    <!-- Botón para limpiar historial -->
                    <div class="clear-history-btn">
                        <button class="btn btn-outline-danger w-100" onclick="clearHistory()" id="clearHistoryBtn" style="display: none;">
                            <i class="bi bi-trash me-2"></i>Limpiar Historial
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let calcExpression = '';
        let calcMode = 'basic';
        let calcHistory = [];

        // Cargar historial del localStorage al iniciar
        window.addEventListener('DOMContentLoaded', function() {
            loadHistory();
        });

        function updateDisplay() {
            const display = document.getElementById('calculatorDisplay');
            const expression = document.getElementById('calculatorExpression');
            
            if (calcExpression === '') {
                display.value = '0';
                expression.value = '';
            } else {
                expression.value = calcExpression;
                display.value = calcExpression;
            }
        }

        function appendToExpression(value) {
            if (calcExpression === '0' || calcExpression === 'Error') {
                calcExpression = value;
            } else {
                calcExpression += value;
            }
            updateDisplay();
        }

        function appendFunction(func) {
            const funcName = func.split('.')[1];
            if (funcName === 'pow') {
                calcExpression += 'Math.pow(';
            } else {
                calcExpression += func + '(';
            }
            updateDisplay();
        }

        function calculate() {
            try {
                let expression = calcExpression;
                const originalExpression = calcExpression;
                
                if (expression.includes('!')) {
                    expression = expression.replace(/(\d+)!/g, (match, num) => {
                        return factorial(parseInt(num));
                    });
                }
                
                const result = eval(expression);
                document.getElementById('calculatorDisplay').value = result;
                document.getElementById('calculatorExpression').value = calcExpression + ' =';
                
                // Agregar al historial
                addToHistory(originalExpression, result);
                
                calcExpression = result.toString();
            } catch (error) {
                document.getElementById('calculatorDisplay').value = 'Error';
                calcExpression = 'Error';
            }
        }

        function addToHistory(expression, result) {
            const historyItem = {
                expression: expression,
                result: result,
                timestamp: new Date().toLocaleTimeString()
            };
            
            calcHistory.unshift(historyItem); // Agregar al inicio
            
            // Limitar a 50 items
            if (calcHistory.length > 50) {
                calcHistory = calcHistory.slice(0, 50);
            }
            
            saveHistory();
            renderHistory();
        }

        function renderHistory() {
            const historyList = document.getElementById('historyList');
            const clearBtn = document.getElementById('clearHistoryBtn');
            
            if (calcHistory.length === 0) {
                historyList.innerHTML = `
                    <div class="history-empty">
                        <i class="bi bi-calculator" style="font-size: 3rem;"></i>
                        <p class="mt-3">No hay cálculos aún</p>
                        <small>Comienza a calcular para ver tu historial</small>
                    </div>
                `;
                clearBtn.style.display = 'none';
            } else {
                let html = '';
                calcHistory.forEach((item, index) => {
                    html += `
                        <div class="history-item" onclick="reuseCalculation('${item.expression}', '${item.result}')">
                            <div class="d-flex justify-content-between align-items-start mb-1">
                                <small class="text-muted">
                                    <i class="bi bi-clock"></i> ${item.timestamp}
                                </small>
                                <button class="btn btn-sm btn-link text-danger p-0" onclick="event.stopPropagation(); deleteHistoryItem(${index})">
                                    <i class="bi bi-x-lg"></i>
                                </button>
                            </div>
                            <div class="history-expression">${item.expression}</div>
                            <div class="history-result">= ${item.result}</div>
                        </div>
                    `;
                });
                historyList.innerHTML = html;
                clearBtn.style.display = 'block';
            }
        }

        function reuseCalculation(expression, result) {
            calcExpression = result.toString();
            updateDisplay();
        }

        function deleteHistoryItem(index) {
            calcHistory.splice(index, 1);
            saveHistory();
            renderHistory();
        }

        function clearHistory() {
            if (confirm('¿Estás seguro de que quieres limpiar todo el historial?')) {
                calcHistory = [];
                saveHistory();
                renderHistory();
            }
        }

        function saveHistory() {
            localStorage.setItem('calcHistory', JSON.stringify(calcHistory));
        }

        function loadHistory() {
            const saved = localStorage.getItem('calcHistory');
            if (saved) {
                calcHistory = JSON.parse(saved);
                renderHistory();
            }
        }

        function factorial(n) {
            if (n === 0 || n === 1) return 1;
            let result = 1;
            for (let i = 2; i <= n; i++) {
                result *= i;
            }
            return result;
        }

        function clearCalculator() {
            calcExpression = '';
            updateDisplay();
        }

        function deleteLast() {
            if (calcExpression.length > 0) {
                calcExpression = calcExpression.slice(0, -1);
            }
            updateDisplay();
        }

        function switchCalcMode(mode) {
            calcMode = mode;
            const basicBtn = document.getElementById('btnBasic');
            const scientificBtn = document.getElementById('btnScientific');
            const basicButtons = document.getElementById('basicButtons');
            const scientificButtons = document.getElementById('scientificButtons');
            
            if (mode === 'basic') {
                basicBtn.classList.add('active');
                scientificBtn.classList.remove('active');
                basicButtons.style.display = 'grid';
                scientificButtons.style.display = 'none';
            } else {
                basicBtn.classList.remove('active');
                scientificBtn.classList.add('active');
                basicButtons.style.display = 'none';
                scientificButtons.style.display = 'grid';
            }
        }

        // Soporte para teclado
        document.addEventListener('keydown', function(event) {
            const key = event.key;
            
            if (key >= '0' && key <= '9') {
                appendToExpression(key);
            } else if (key === '+' || key === '-' || key === '*' || key === '/') {
                appendToExpression(key);
            } else if (key === '.') {
                appendToExpression('.');
            } else if (key === 'Enter' || key === '=') {
                event.preventDefault();
                calculate();
            } else if (key === 'Escape') {
                clearCalculator();
            } else if (key === 'Backspace') {
                event.preventDefault();
                deleteLast();
            } else if (key === '(' || key === ')') {
                appendToExpression(key);
            }
        });
    </script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
