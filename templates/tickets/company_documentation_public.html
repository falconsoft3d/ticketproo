{% extends 'public_base.html' %}
{% load static %}

{% block title %}{{ page_title }}{% endblock %}

{% block extra_css %}
<style>
.documentation-header {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    padding: 2rem 0;
    margin-bottom: 2rem;
}
.url-card {
    transition: transform 0.2s, box-shadow 0.2s;
    border: none;
    box-shadow: 0 2px 10px rgba(0,0,0,0.1);
}
.url-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 5px 20px rgba(0,0,0,0.2);
}
.credentials-section {
    background: #f8f9fa;
    border-left: 4px solid #007bff;
    padding: 1rem;
    margin-top: 1rem;
}
.password-field {
    font-family: 'Courier New', monospace;
    background: #fff;
    padding: 0.25rem 0.5rem;
    border-radius: 0.25rem;
    border: 1px solid #dee2e6;
    display: inline-block;
    min-width: 150px;
}
.url-number-badge {
    font-size: 0.75rem;
    font-weight: bold;
    width: 24px;
    height: 24px;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    border-radius: 50%;
}
</style>
{% endblock %}

{% block content %}
<!-- Header -->
<div class="documentation-header">
    <div class="container">
        <div class="row">
            <div class="col-12 text-center">
                <h1 class="display-4 mb-3">
                    <i class="bi bi-collection"></i> {{ documentation.title }}
                </h1>
                <p class="lead mb-0">
                    <i class="bi bi-building"></i> {{ documentation.company.name }}
                </p>
                {% if documentation.description %}
                <p class="mt-3 opacity-75">
                    {{ documentation.description }}
                </p>
                {% endif %}
            </div>
        </div>
    </div>
</div>

<div class="container">
    {% if urls %}
    <!-- Lista de URLs -->
    <div class="row">
        {% for url in urls %}
        <div class="col-lg-6 col-xl-4 mb-4">
            <div class="card url-card h-100">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-start mb-3">
                        <h5 class="card-title text-primary d-flex align-items-center">
                            <span class="badge bg-primary url-number-badge me-2">{{ forloop.counter }}</span>
                            <span><i class="bi bi-link-45deg me-1"></i>{{ url.title }}</span>
                        </h5>
                        {% if url.has_credentials %}
                            <span class="badge bg-warning text-dark">
                                <i class="bi bi-shield-lock"></i> Con acceso
                            </span>
                        {% endif %}
                    </div>
                    
                    {% if url.description %}
                    <p class="card-text text-muted mb-3">
                        {{ url.description }}
                    </p>
                    {% endif %}
                    
                    <div class="mb-3">
                        <a href="{{ url.url }}" 
                           target="_blank" 
                           class="btn btn-primary w-100">
                            <span class="badge bg-white text-primary me-2">{{ forloop.counter }}</span>
                            <i class="bi bi-box-arrow-up-right"></i> Acceder al sitio
                        </a>
                    </div>
                    
                    <div class="small text-muted mb-2">
                        <i class="bi bi-globe"></i> {{ url.url|truncatechars:40 }}
                    </div>
                    
                    <!-- Credenciales -->
                    {% if url.username or url.password %}
                    <div class="credentials-section">
                        <h6 class="text-primary mb-2">
                            <i class="bi bi-key"></i> Datos de acceso
                        </h6>
                        
                        {% if url.username %}
                        <div class="mb-2">
                            <strong>Usuario:</strong><br>
                            <span class="password-field">{{ url.username }}</span>
                            <button type="button" 
                                    class="btn btn-sm btn-outline-secondary ms-1 copy-btn" 
                                    data-copy="{{ url.username }}"
                                    title="Copiar usuario">
                                <i class="bi bi-clipboard"></i>
                            </button>
                        </div>
                        {% endif %}
                        
                        {% if url.password %}
                        <div class="mb-2">
                            <strong>Contraseña:</strong><br>
                            <span class="password-field toggle-password-field" data-password="{{ url.password }}">
                                ••••••••
                            </span>
                            <button type="button" 
                                    class="btn btn-sm btn-outline-secondary ms-1 toggle-password" 
                                    title="Mostrar/Ocultar contraseña">
                                <i class="bi bi-eye"></i>
                            </button>
                            <button type="button" 
                                    class="btn btn-sm btn-outline-secondary copy-btn" 
                                    data-copy="{{ url.password }}"
                                    title="Copiar contraseña">
                                <i class="bi bi-clipboard"></i>
                            </button>
                        </div>
                        {% endif %}
                    </div>
                    {% endif %}
                    
                    <!-- Notas adicionales -->
                    {% if url.notes %}
                    <div class="mt-3 p-2 bg-light rounded">
                        <small>
                            <strong><i class="bi bi-info-circle"></i> Notas:</strong><br>
                            {{ url.notes|linebreaks }}
                        </small>
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
    
    <!-- Información adicional -->
    <div class="row mt-5">
        <div class="col-12">
            <div class="card bg-light">
                <div class="card-body text-center">
                    <h5 class="text-muted">
                        <i class="bi bi-info-circle"></i> Información
                    </h5>
                    <p class="text-muted mb-0">
                        Esta documentación contiene {{ urls.count }} enlace{{ urls.count|pluralize }} 
                        proporcionado{{ urls.count|pluralize }} por <strong>{{ documentation.company.name }}</strong>.
                    </p>
                    <small class="text-muted">
                        Última actualización: {{ documentation.updated_at|date:"d/m/Y H:i" }}
                    </small>
                </div>
            </div>
        </div>
    </div>
    
    {% else %}
    <!-- Sin URLs -->
    <div class="row">
        <div class="col-12">
            <div class="card">
                <div class="card-body text-center py-5">
                    <i class="bi bi-link-45deg display-1 text-muted"></i>
                    <h4 class="mt-3 text-muted">No hay enlaces disponibles</h4>
                    <p class="text-muted">
                        Esta documentación está en proceso de configuración.<br>
                        Por favor, contacta con {{ documentation.company.name }} para más información.
                    </p>
                </div>
            </div>
        </div>
    </div>
    {% endif %}
</div>

<!-- Toast para confirmación de copiado -->
<div class="toast-container position-fixed bottom-0 end-0 p-3">
    <div id="copyToast" class="toast" role="alert" aria-live="assertive" aria-atomic="true">
        <div class="toast-header">
            <i class="bi bi-check-circle text-success me-2"></i>
            <strong class="me-auto">Copiado</strong>
            <button type="button" class="btn-close" data-bs-dismiss="toast"></button>
        </div>
        <div class="toast-body">
            Texto copiado al portapapeles
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    
    // Manejar mostrar/ocultar contraseñas
    const toggleButtons = document.querySelectorAll('.toggle-password');
    toggleButtons.forEach(button => {
        button.addEventListener('click', function() {
            const passwordField = this.previousElementSibling;
            const passwordText = passwordField.getAttribute('data-password');
            const isHidden = this.querySelector('i').classList.contains('bi-eye');
            
            if (isHidden) {
                // Mostrar contraseña
                passwordField.textContent = passwordText;
                this.querySelector('i').className = 'bi bi-eye-slash';
                this.title = 'Ocultar contraseña';
            } else {
                // Ocultar contraseña
                passwordField.textContent = '••••••••';
                this.querySelector('i').className = 'bi bi-eye';
                this.title = 'Mostrar contraseña';
            }
        });
    });
    
    // Manejar botones de copiar
    const copyButtons = document.querySelectorAll('.copy-btn');
    copyButtons.forEach(button => {
        button.addEventListener('click', function() {
            const textToCopy = this.getAttribute('data-copy');
            
            // Crear elemento temporal para copiar
            const tempInput = document.createElement('input');
            tempInput.value = textToCopy;
            document.body.appendChild(tempInput);
            tempInput.select();
            
            try {
                document.execCommand('copy');
                showToast();
                
                // Cambiar ícono temporalmente
                const icon = this.querySelector('i');
                const originalClass = icon.className;
                icon.className = 'bi bi-check';
                
                setTimeout(() => {
                    icon.className = originalClass;
                }, 2000);
                
            } catch (err) {
                console.error('Error al copiar:', err);
            }
            
            document.body.removeChild(tempInput);
        });
    });
    
    function showToast() {
        const toastElement = document.getElementById('copyToast');
        const toast = new bootstrap.Toast(toastElement);
        toast.show();
    }
});
</script>
{% endblock %}