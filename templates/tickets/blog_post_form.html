{% extends "base.html" %}

{% block page_title %}{{ page_title }}{% endblock %}

{% block extra_head %}
<!-- Incluir editor rich text -->
<script src="https://cdn.tiny.cloud/1/no-api-key/tinymce/5/tinymce.min.js" referrerpolicy="origin"></script>
{% endblock %}

{% block content %}
<div class="row">
    <div class="col-md-8">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h1>
                <i class="fas fa-edit"></i> {{ page_title }}
            </h1>
            <a href="{% url 'blog_post_list_admin' %}" class="btn btn-outline-secondary">
                <i class="fas fa-arrow-left"></i> Volver a la lista
            </a>
        </div>
        
        <form method="POST" enctype="multipart/form-data">
            {% csrf_token %}
            
            <div class="card">
                <div class="card-header">
                    <h5><i class="fas fa-newspaper"></i> Contenido del Artículo</h5>
                </div>
                <div class="card-body">
                    <!-- Título -->
                    <div class="mb-3">
                        <label for="{{ form.title.id_for_label }}" class="form-label">Título *</label>
                        {{ form.title }}
                        {% if form.title.errors %}
                        <div class="text-danger small">{{ form.title.errors.0 }}</div>
                        {% endif %}
                    </div>
                    
                    <!-- Categoría -->
                    <div class="mb-3">
                        <label for="{{ form.category.id_for_label }}" class="form-label">Categoría *</label>
                        {{ form.category }}
                        {% if form.category.errors %}
                        <div class="text-danger small">{{ form.category.errors.0 }}</div>
                        {% endif %}
                        <small class="form-text text-muted">
                            <a href="{% url 'blog_category_create' %}" target="_blank">¿No encuentras la categoría? Crear nueva</a>
                        </small>
                    </div>
                    
                    <!-- Imagen destacada -->
                    <div class="mb-3">
                        <label for="{{ form.featured_image.id_for_label }}" class="form-label">Imagen destacada</label>
                        {{ form.featured_image }}
                        {% if form.featured_image.errors %}
                        <div class="text-danger small">{{ form.featured_image.errors.0 }}</div>
                        {% endif %}
                        <small class="form-text text-muted">
                            Recomendado: imagen de 1200x630 píxeles para mejor SEO y redes sociales.
                        </small>
                    </div>
                    
                    <!-- Extracto -->
                    <div class="mb-3">
                        <label for="{{ form.excerpt.id_for_label }}" class="form-label">Extracto</label>
                        {{ form.excerpt }}
                        {% if form.excerpt.errors %}
                        <div class="text-danger small">{{ form.excerpt.errors.0 }}</div>
                        {% endif %}
                        <small class="form-text text-muted">
                            Breve resumen del artículo que aparecerá en la lista de posts y en buscadores.
                        </small>
                    </div>
                    
                    <!-- Contenido -->
                    <div class="mb-3">
                        <label for="{{ form.content.id_for_label }}" class="form-label">Contenido *</label>
                        {{ form.content }}
                        {% if form.content.errors %}
                        <div class="text-danger small">{{ form.content.errors.0 }}</div>
                        {% endif %}
                    </div>
                </div>
            </div>
            
            <div class="card mt-3">
                <div class="card-header">
                    <h5><i class="fas fa-cog"></i> Configuración y SEO</h5>
                </div>
                <div class="card-body">
                    <!-- Tags -->
                    <div class="mb-3">
                        <label for="{{ form.tags.id_for_label }}" class="form-label">Tags</label>
                        {{ form.tags }}
                        {% if form.tags.errors %}
                        <div class="text-danger small">{{ form.tags.errors.0 }}</div>
                        {% endif %}
                        <small class="form-text text-muted">
                            Separar con espacios. Ejemplo: marketing digital seo ventas
                        </small>
                    </div>
                    
                    <!-- Meta descripción -->
                    <div class="mb-3">
                        <label for="{{ form.meta_description.id_for_label }}" class="form-label">Meta descripción (SEO)</label>
                        {{ form.meta_description }}
                        {% if form.meta_description.errors %}
                        <div class="text-danger small">{{ form.meta_description.errors.0 }}</div>
                        {% endif %}
                        <small class="form-text text-muted">
                            Descripción para buscadores (recomendado: 150-160 caracteres)
                        </small>
                    </div>
                    
                    <!-- Estado y opciones -->
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="{{ form.status.id_for_label }}" class="form-label">Estado *</label>
                                {{ form.status }}
                                {% if form.status.errors %}
                                <div class="text-danger small">{{ form.status.errors.0 }}</div>
                                {% endif %}
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <div class="form-check mt-4">
                                    {{ form.is_featured }}
                                    <label class="form-check-label" for="{{ form.is_featured.id_for_label }}">
                                        Artículo destacado
                                    </label>
                                </div>
                                <small class="form-text text-muted">
                                    Los artículos destacados aparecen en la sección principal del blog.
                                </small>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="mt-4">
                <button type="submit" class="btn btn-success">
                    <i class="fas fa-save"></i> Guardar Artículo
                </button>
                <a href="{% url 'blog_post_list_admin' %}" class="btn btn-secondary">
                    <i class="fas fa-times"></i> Cancelar
                </a>
            </div>
        </form>
    </div>
    
    <!-- Sidebar con ayuda -->
    <div class="col-md-4">
        <div class="card">
            <div class="card-header">
                <h6><i class="fas fa-lightbulb"></i> Consejos para escribir</h6>
            </div>
            <div class="card-body">
                <ul class="list-unstyled small">
                    <li class="mb-2">
                        <strong>Título:</strong> Usa palabras clave relevantes y manténlo claro.
                    </li>
                    <li class="mb-2">
                        <strong>Extracto:</strong> Resume el contenido principal en 2-3 frases.
                    </li>
                    <li class="mb-2">
                        <strong>Imagen:</strong> Usa imágenes de alta calidad relacionadas con el tema.
                    </li>
                    <li class="mb-2">
                        <strong>SEO:</strong> Incluye palabras clave naturalmente en el contenido.
                    </li>
                    <li class="mb-2">
                        <strong>Tags:</strong> Usa etiquetas relevantes para mejorar la búsqueda.
                    </li>
                </ul>
            </div>
        </div>
        
        <div class="card mt-3">
            <div class="card-header">
                <h6><i class="fas fa-eye"></i> Vista previa</h6>
            </div>
            <div class="card-body">
                <p class="small">
                    Guarda el artículo como borrador para previsualizarlo antes de publicar.
                </p>
                <button type="button" class="btn btn-outline-info btn-sm" onclick="previewPost()">
                    <i class="fas fa-search"></i> Vista previa
                </button>
            </div>
        </div>
    </div>
</div>

<script>
// Inicializar TinyMCE para el editor de contenido
tinymce.init({
    selector: '#id_content',
    height: 400,
    menubar: false,
    plugins: [
        'advlist autolink lists link image charmap print preview anchor',
        'searchreplace visualblocks code fullscreen',
        'insertdatetime media table paste code help wordcount'
    ],
    toolbar: 'undo redo | formatselect | bold italic backcolor | alignleft aligncenter alignright alignjustify | bullist numlist outdent indent | removeformat | help',
    content_css: '//www.tiny.cloud/css/codepen.min.css'
});

function previewPost() {
    const title = document.getElementById('id_title').value;
    const content = tinymce.get('id_content').getContent();
    
    if (!title || !content) {
        alert('Por favor completa al menos el título y el contenido para la vista previa.');
        return;
    }
    
    // Aquí podrías implementar una vista previa en modal o nueva ventana
    alert('Función de vista previa en desarrollo. Guarda como borrador para previsualizar.');
}
</script>
{% endblock %}